<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>io7m-r2 0.2.1 Documentation: 2.14. Lighting: Spherical</title><meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8"/><link rel="stylesheet" type="text/css" href="kstructural-layout.css"/><link rel="stylesheet" type="text/css" href="kstructural-colour.css"/><link rel="stylesheet" type="text/css" href="documentation.css"/></head><body><div class="st300_body"><div class="st300_navbar st300_navbar_top"><table class="st300_navbar_table" summary="st300_Navigation bar"><tr><td class="st300_navbar_prev_title_cell">2.13. Lighting: Directional</td><td class="st300_navbar_up_title_cell">2. Design And Implementation</td><td class="st300_navbar_next_title_cell">2.15. Lighting: Projective</td></tr><tr><td class="st300_navbar_prev_file_cell"><a rel="previous" href="p2s13.xhtml#st300_p2s13" title="Go to previous page">Previous</a></td><td class="st300_navbar_up_file_cell"><a rel="up" href="p2.xhtml#st300_p2" title="Go to parent page">Up</a></td><td class="st300_navbar_next_file_cell"><a rel="next" href="p2s15.xhtml#st300_p2s15" title="Go to next page">Next</a></td></tr></table><hr class="st300_hr"/></div><div class="st300_section_container"><a id="di.lighting.spherical"/><div class="st300_section_title_number"><a id="st300_p2s14" href="#st300_p2s14" title="Section 2.14: Lighting: Spherical">2.14</a></div><div class="st300_section_title">Lighting: Spherical</div><ul class="st300_contents st300_section_contents_outer st300_section_contents"><li class="st300_contents_item st300_contents_item1 st300_contents_item_subsection"><a href="p2s14.xhtml#st300_p2s14ss1" title="Link to subsection 2.14.1: Overview">2.14.1. Overview</a></li><li class="st300_contents_item st300_contents_item1 st300_contents_item_subsection"><a href="p2s14.xhtml#st300_p2s14ss2" title="Link to subsection 2.14.2: Attenuation">2.14.2. Attenuation</a></li><li class="st300_contents_item st300_contents_item1 st300_contents_item_subsection"><a href="p2s14.xhtml#st300_p2s14ss3" title="Link to subsection 2.14.3: Application">2.14.3. Application</a></li><li class="st300_contents_item st300_contents_item1 st300_contents_item_subsection"><a href="p2s14.xhtml#st300_p2s14ss4" title="Link to subsection 2.14.4: Types">2.14.4. Types</a></li></ul><div class="st300_subsection_container"><a id="di.lighting.spherical.overview"/><div class="st300_subsection_title_number"><a id="st300_p2s14ss1" href="#st300_p2s14ss1" title="Subsection 2.14.1: Overview">2.14.1</a></div><div class="st300_subsection_title">Overview</div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p2s14ss1c1" href="#st300_p2s14ss1c1" title="Paragraph 2.14.1.1">1</a></div><div class="st300_paragraph">A <span class="st300_term term">spherical light</span> in the <span class="st300_term package">r2</span> package is a light that emits rays of light in all directions from a given <span class="st300_term term">origin</span> specified in <a class="st300_link" href="p2s3.xhtml#di.coords.eye">eye space</a> up to a given maximum <span class="st300_term term">radius</span>.</div></div><div class="st300_formal_item"><div class="st300_formal_item_title"><a id="st300_p2s14ss1c2" href="#st300_p2s14ss1c2" title="Formal item 2.14.1.2: Spherical lighting">2.14.1.2 Spherical lighting</a></div><div class="st300_formal_item_content"><img class="st300_image" alt="Spherical lighting" src="images/spherical_diagram.png"/></div></div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p2s14ss1c3" href="#st300_p2s14ss1c3" title="Paragraph 2.14.1.3">3</a></div><div class="st300_paragraph">The term <span class="st300_term term">spherical</span> comes from the fact that the light has a defined radius. Most rendering systems instead use <span class="st300_term term">point</span> lights that specify multiple <span class="st300_term term">attenuation</span> constants to control how light is attenuated over distance. The problem with this approach is that it requires solving a quadratic equation to determine a minimum bounding sphere that can contain the light. Essentially, the programmer/artist is forced to determine "at which radius does the contribution from this light effectively reach zero?". With spherical lights, the maximum radius is declared up front, and a single falloff value is used to determine the attenuation curve within that radius. This makes spherical lights more intuitive to use: The programmer/artist simply places a sphere within the scene and knows exactly from the radius which objects are lit by it. It also means that bounding light volumes can be trivially constructed from unit spheres by simply scaling those spheres by the light radius, when performing <a class="st300_link" href="p2s18.xhtml#di.deferred">deferred rendering</a>.</div></div></div><div class="st300_subsection_container"><a id="di.lighting.spherical.attenuation"/><div class="st300_subsection_title_number"><a id="st300_p2s14ss2" href="#st300_p2s14ss2" title="Subsection 2.14.2: Attenuation">2.14.2</a></div><div class="st300_subsection_title">Attenuation</div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p2s14ss2c1" href="#st300_p2s14ss2c1" title="Paragraph 2.14.2.1">1</a></div><div class="st300_paragraph">The light supports <a class="st300_link" href="p2s12.xhtml#di.lighting.attenuation">attenuation</a> using the <span class="st300_term term">radius</span> as the maximum range.</div></div></div><div class="st300_subsection_container"><a id="di.lighting.spherical.application"/><div class="st300_subsection_title_number"><a id="st300_p2s14ss3" href="#st300_p2s14ss3" title="Subsection 2.14.3: Application">2.14.3</a></div><div class="st300_subsection_title">Application</div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p2s14ss3c1" href="#st300_p2s14ss3c1" title="Paragraph 2.14.3.1">1</a></div><div class="st300_paragraph">The final light applied to the surface is given by <span class="st300_term function">spherical</span> <a class="st300_link_external" href="haskell/Spherical.hs">(Spherical.hs)</a>, where <span class="st300_term variable">sr</span>, <span class="st300_term variable">sg</span>, <span class="st300_term variable">sb</span> are the red, green, and blue channels, respectively, of the surface being lit. The surface-to-light vector <span class="st300_term variable">stl</span> is calculated by normalizing the negation of the difference between the the current eye space <span class="st300_term variable">surface_position</span> and the eye space origin of the light.</div></div><div class="st300_formal_item"><div class="st300_formal_item_title"><a id="st300_p2s14ss3c2" href="#st300_p2s14ss3c2" title="Formal item 2.14.3.2: Spherical lighting (Application)">2.14.3.2 Spherical lighting (Application)</a></div><div class="st300_formal_item_content"><pre class="st300_verbatim">module Spherical where

import qualified Attenuation
import qualified Color4
import qualified Direction
import qualified LightDiffuse
import qualified LightSpecular
import qualified LightSpherical
import qualified Normal
import qualified Position3
import qualified Specular
import qualified Spaces
import qualified Vector3f
import qualified Vector4f

spherical :: Direction.T Spaces.Eye -&gt; Normal.T -&gt; Position3.T Spaces.Eye -&gt; LightSpherical.T -&gt; Specular.T -&gt; Color4.T -&gt; Vector3f.T
spherical view n surface_position light specular (Vector4f.V4 sr sg sb _) =
  let
    position_diff   = Position3.sub3 surface_position (LightSpherical.origin light)
    stl             = Vector3f.normalize (Vector3f.negation position_diff)
    distance        = Vector3f.magnitude (position_diff)
    attenuation     = Attenuation.attenuation (LightSpherical.radius light) (LightSpherical.falloff light) distance
    light_color     = LightSpherical.color light
    light_intensity = LightSpherical.intensity light
    light_d         = LightDiffuse.diffuse stl n light_color light_intensity
    light_s         = LightSpecular.specularBlinnPhong stl view n light_color light_intensity specular
    light_da        = Vector3f.scale light_d attenuation
    light_sa        = Vector3f.scale light_s attenuation
    lit_d           = Vector3f.mult3 (Vector3f.V3 sr sg sb) light_da
    lit_s           = Vector3f.add3 lit_d light_sa
  in
    lit_s
</pre></div></div></div><div class="st300_subsection_container"><a id="di.lighting.spherical.types"/><div class="st300_subsection_title_number"><a id="st300_p2s14ss4" href="#st300_p2s14ss4" title="Subsection 2.14.4: Types">2.14.4</a></div><div class="st300_subsection_title">Types</div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p2s14ss4c1" href="#st300_p2s14ss4c1" title="Paragraph 2.14.4.1">1</a></div><div class="st300_paragraph">Spherical lights are represented in the <span class="st300_term package">r2</span> package by the <a class="st300_link_external" href="apidocs/com/io7m/r2/core/R2LightSphericalSingle.html">R2LightSphericalSingle</a> type.</div></div></div></div><div class="st300_navbar st300_navbar_bottom"><hr class="st300_hr"/><table class="st300_navbar_table" summary="st300_Navigation bar"><tr><td class="st300_navbar_prev_file_cell"><a rel="previous" href="p2s13.xhtml#st300_p2s13" title="Go to previous page">Previous</a></td><td class="st300_navbar_up_file_cell"><a rel="up" href="p2.xhtml#st300_p2" title="Go to parent page">Up</a></td><td class="st300_navbar_next_file_cell"><a rel="next" href="p2s15.xhtml#st300_p2s15" title="Go to next page">Next</a></td></tr><tr><td class="st300_navbar_prev_title_cell">2.13. Lighting: Directional</td><td class="st300_navbar_up_title_cell">2. Design And Implementation</td><td class="st300_navbar_next_title_cell">2.15. Lighting: Projective</td></tr></table></div></div></body></html>
